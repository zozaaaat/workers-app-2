# نظام إدارة ملفات الرخص والأرشيف 📁

## نظرة عامة
تم إنشاء نظام متكامل لإدارة ملفات الرخص والأرشيف يشمل:

### 🎯 الميزات الرئيسية

#### 1. نظام ملفات الرخص
- **الرخص الرئيسية والفرعية**: دعم كامل للرخص الهرمية
- **أنواع الرخص المدعومة**:
  - الرخصة التجارية
  - رخصة الاستيراد والتصدير
  - الرخصة الصناعية
  - الرخصة المهنية
  - الرخصة الصحية
  - الرخصة البيئية
  - رخصة السلامة من الحريق
  - رخصة الإعلان والدعاية

#### 2. نظام الأرشيف المتقدم
- **فئات الأرشيف**:
  - 📄 العقود (عقود الإيجار، عقود الخدمة، عقود الصيانة)
  - 🧾 الفواتير والإيصالات (إيصالات الإيجار، فواتير الخدمات)
  - 🛡️ التأمينات (بوالص التأمين)
  - 🏦 الضمانات (الضمانات البنكية)
  - ⚖️ المستندات القانونية
  - 💰 المستندات المالية
  - ⚡ الخدمات العامة (الكهرباء، الماء، الغاز)
  - 🔧 الصيانة
  - 📂 أخرى

#### 3. نظام الإشعارات الذكي
- **إشعارات انتهاء الصلاحية**:
  - إشعار قبل 6 أشهر
  - إشعار قبل 3 أشهر
  - إشعار قبل شهر
  - إشعار قبل أسبوع
- **إشعارات المستحقات المتكررة**:
  - الإيجار الشهري
  - فواتير الخدمات
  - المدفوعات المتكررة

#### 4. نظام البحث المتقدم
- البحث النصي في جميع المستندات
- التصفية حسب الفئة
- التصفية حسب الحالة
- التصفية حسب التاريخ

### 📊 بنية قاعدة البيانات

#### الجداول الرئيسية:
1. **license_documents** - مستندات الرخص
2. **document_archive** - أرشيف المستندات
3. **license_types** - أنواع الرخص
4. **archive_categories** - فئات الأرشيف
5. **archive_types** - أنواع الأرشيف

### 🛠️ الملفات المنشأة

#### Backend (Python/FastAPI):
```
app/
├── models_license_document.py     # نماذج قاعدة البيانات
├── crud/license_documents.py      # عمليات قاعدة البيانات
├── schemas/license_documents.py   # مخططات البيانات
├── routers/license_documents.py   # API endpoints
└── main.py                        # (محدث)

alembic/versions/
└── 20250109_add_license_documents_and_archive.py  # Migration

uploaded_files/
├── licenses/                      # ملفات الرخص
└── archive/                       # ملفات الأرشيف
```

#### Frontend (React/TypeScript):
```
frontend/src/pages/
└── LicenseDocumentsPage.tsx       # واجهة المستخدم
```

### 🚀 كيفية الاستخدام

#### 1. إضافة مستند رخصة:
```bash
POST /api/license-documents/licenses/{license_id}/documents
```

#### 2. إضافة مستند للأرشيف:
```bash
POST /api/license-documents/archive
```

#### 3. البحث في المستندات:
```bash
GET /api/license-documents/search?search_term=...
```

#### 4. الحصول على الإشعارات:
```bash
GET /api/license-documents/notifications
```

### 📋 أمثلة على الاستخدام

#### مثال 1: رفع عقد إيجار
```javascript
const formData = new FormData();
formData.append('file', contractFile);
formData.append('archive_type', 'rent_contract');
formData.append('category', 'contracts');
formData.append('title', 'عقد إيجار المكتب الرئيسي');
formData.append('amount', '10000');
formData.append('currency', 'EGP');
formData.append('start_date', '2025-01-01');
formData.append('end_date', '2025-12-31');
formData.append('party_name', 'مالك العقار');
formData.append('company_id', '1');

await axios.post('/api/license-documents/archive', formData);
```

#### مثال 2: رفع مستند رخصة تجارية
```javascript
const formData = new FormData();
formData.append('file', licenseFile);
formData.append('document_type', 'commercial_license');
formData.append('license_number', 'CR-2025-001');
formData.append('issue_date', '2025-01-01');
formData.append('expiry_date', '2026-01-01');
formData.append('issuing_authority', 'وزارة التجارة');

await axios.post('/api/license-documents/licenses/1/documents', formData);
```

### 🔧 التكوين المطلوب

#### Environment Variables:
```bash
# في ملف .env
UPLOAD_DIR=uploaded_files
MAX_FILE_SIZE=10485760  # 10MB
ALLOWED_EXTENSIONS=pdf,doc,docx,jpg,jpeg,png
```

#### Database Migration:
```bash
alembic upgrade head
```

### 📱 واجهة المستخدم

#### الميزات:
- **تبويبات منظمة**: مستندات الرخص، الأرشيف، الإحصائيات
- **بحث متقدم**: بحث نصي مع تصفية
- **إشعارات فورية**: تنبيهات للمستندات المنتهية
- **رفع الملفات**: واجهة سهلة لرفع المستندات
- **عرض بطاقات**: عرض جميل للمستندات المؤرشفة

### 🎨 الألوان والأيقونات

#### فئات الأرشيف:
- 🟢 العقود - أخضر (`#28a745`)
- 🔵 الفواتير - أزرق (`#007bff`)
- 🟦 التأمينات - فيروزي (`#17a2b8`)
- 🟡 الضمانات - أصفر (`#ffc107`)
- 🔴 المستندات القانونية - أحمر (`#dc3545`)
- 🟣 المستندات المالية - بنفسجي (`#6f42c1`)
- 🟠 الخدمات العامة - برتقالي (`#fd7e14`)
- 🟢 الصيانة - تيل (`#20c997`)
- 🔘 أخرى - رمادي (`#6c757d`)

### 🔔 نظام التذكيرات

#### للرخص:
- تذكير قبل 6 أشهر من انتهاء الصلاحية
- تذكير قبل 3 أشهر من انتهاء الصلاحية
- تذكير قبل شهر من انتهاء الصلاحية
- تذكير قبل أسبوع من انتهاء الصلاحية

#### للأرشيف:
- تذكير للعقود المنتهية
- تذكير للمدفوعات المتكررة
- تذكير للمستحقات القادمة

### 🛡️ الأمان

#### حماية الملفات:
- التحقق من أنواع الملفات المسموحة
- تشفير أسماء الملفات
- تنظيم المجلدات حسب النوع
- النسخ الاحتياطي التلقائي

#### التحكم في الوصول:
- الربط بنظام الأذونات الموجود
- تسجيل جميع العمليات
- تتبع تاريخ التعديلات

### 📈 المقاييس والإحصائيات

#### تقارير متاحة:
- عدد المستندات حسب النوع
- المستندات المنتهية الصلاحية
- المستحقات المتكررة
- إحصائيات الاستخدام

### 🔮 التطوير المستقبلي

#### ميزات مخطط لها:
- تقنية OCR لاستخراج النصوص
- التوقيع الرقمي للمستندات
- نظام الموافقات للمستندات
- التكامل مع الأنظمة الخارجية
- تطبيق الموبايل

### 📞 الدعم الفني

للحصول على المساعدة أو الإبلاغ عن مشاكل:
- تحقق من logs الخادم
- راجع قاعدة البيانات
- تأكد من صحة المسارات
- فحص صلاحيات المجلدات

---

**تم التطوير بواسطة**: فريق التطوير - 2025
**آخر تحديث**: يناير 2025
**الإصدار**: 1.0.0
