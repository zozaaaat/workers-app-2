<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± API Debug</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background: #f0f2f5;
            direction: rtl;
        }
        .debug-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-result {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #007bff;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }
        .error { border-left-color: #dc3545; background: #f8d7da; }
        .success { border-left-color: #28a745; background: #d4edda; }
        .warning { border-left-color: #ffc107; background: #fff3cd; }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover { background: #0056b3; }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>ğŸ” Ø§Ø®ØªØ¨Ø§Ø± API Debug</h1>
        <p>Ù‡Ø°Ø§ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙŠØ³Ø§Ø¹Ø¯ ÙÙŠ Ù…Ø¹Ø±ÙØ© Ø³Ø¨Ø¨ Ù…Ø´ÙƒÙ„Ø© `/api/v1/companies`</p>

        <div>
            <button class="btn" onclick="testDirectAPI()">Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø¨Ø§Ø´Ø± Ù„Ù„Ù€ Backend</button>
            <button class="btn" onclick="testProxyAPI()">Ø§Ø®ØªØ¨Ø§Ø± Ø¹Ø¨Ø± Ø§Ù„Ù€ Proxy</button>
            <button class="btn" onclick="testAxiosConfig()">Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Axios</button>
            <button class="btn" onclick="clearCache()">Ù…Ø³Ø­ Ø§Ù„Ù€ Cache</button>
        </div>

        <div id="results"></div>
    </div>

    <script>
        const results = document.getElementById('results');
        
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = `<strong>[${new Date().toLocaleTimeString('ar-SA')}]</strong> ${message}`;
            results.appendChild(div);
            div.scrollIntoView({ behavior: 'smooth' });
        }

        async function testDirectAPI() {
            log('ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ø¨Ø§Ù„Ù€ Backend...');
            
            const endpoints = [
                'http://localhost:8001/',
                'http://localhost:8001/api/health',
                'http://localhost:8001/api/companies',
                'http://localhost:8001/api/v1/companies' // Ù„Ù„ØªØ£ÙƒØ¯ Ø£Ù†Ù‡ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯
            ];

            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(endpoint);
                    if (response.ok) {
                        const data = await response.json();
                        log(`âœ… ${endpoint} - Status: ${response.status} - Data: ${JSON.stringify(data).substring(0, 100)}...`, 'success');
                    } else {
                        log(`âŒ ${endpoint} - Status: ${response.status} - ${response.statusText}`, 'error');
                    }
                } catch (error) {
                    log(`ğŸ’¥ ${endpoint} - Ø®Ø·Ø£: ${error.message}`, 'error');
                }
            }
        }

        async function testProxyAPI() {
            log('ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ø¨Ø± Ø§Ù„Ù€ Proxy...');
            
            const endpoints = [
                '/api/health',
                '/api/companies',
                '/api/v1/companies' // Ù„Ù„ØªØ£ÙƒØ¯
            ];

            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(endpoint);
                    if (response.ok) {
                        const data = await response.json();
                        log(`âœ… ${endpoint} (Proxy) - Status: ${response.status} - Data: ${JSON.stringify(data).substring(0, 100)}...`, 'success');
                    } else {
                        log(`âŒ ${endpoint} (Proxy) - Status: ${response.status} - ${response.statusText}`, 'error');
                    }
                } catch (error) {
                    log(`ğŸ’¥ ${endpoint} (Proxy) - Ø®Ø·Ø£: ${error.message}`, 'error');
                }
            }
        }

        async function testAxiosConfig() {
            log('ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Axios Ù…Ø­Ø§ÙƒØ§Ø©...');
            
            // Ù…Ø­Ø§ÙƒØ§Ø© axios config
            const mockAxiosConfig = {
                baseURL: '/api',
                timeout: 10000,
                headers: {
                    'Content-Type': 'application/json',
                }
            };
            
            log(`ğŸ“‹ Axios Config: ${JSON.stringify(mockAxiosConfig, null, 2)}`, 'info');
            
            // Ù…Ø­Ø§ÙƒØ§Ø© Ø·Ù„Ø¨ companies
            const companiesURL = mockAxiosConfig.baseURL + '/companies?page=1&page_size=20';
            log(`ğŸŒ URL Ø§Ù„Ù…ØªÙˆÙ‚Ø¹: ${companiesURL}`, 'info');
            
            try {
                const response = await fetch(companiesURL);
                if (response.ok) {
                    const data = await response.json();
                    log(`âœ… Companies API ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ - Data: ${JSON.stringify(data).substring(0, 100)}...`, 'success');
                } else {
                    log(`âŒ Companies API Ù„Ø§ ÙŠØ¹Ù…Ù„ - Status: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`ğŸ’¥ Ø®Ø·Ø£ ÙÙŠ Companies API: ${error.message}`, 'error');
            }
        }

        function clearCache() {
            log('ğŸ§¹ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù€ Cache...');
            
            // Ù…Ø³Ø­ localStorage
            localStorage.clear();
            log('âœ… ØªÙ… Ù…Ø³Ø­ localStorage', 'success');
            
            // Ù…Ø³Ø­ sessionStorage
            sessionStorage.clear();
            log('âœ… ØªÙ… Ù…Ø³Ø­ sessionStorage', 'success');
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø³Ø­ service worker cache
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations().then(function(registrations) {
                    for(let registration of registrations) {
                        registration.unregister();
                        log('âœ… ØªÙ… Ø¥Ù„ØºØ§Ø¡ ØªØ³Ø¬ÙŠÙ„ Service Worker', 'success');
                    }
                });
            }
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø³Ø­ caches API
            if ('caches' in window) {
                caches.keys().then(function(names) {
                    for (let name of names) {
                        caches.delete(name);
                        log(`âœ… ØªÙ… Ù…Ø³Ø­ cache: ${name}`, 'success');
                    }
                });
            }
            
            log('âš ï¸ ÙŠÙÙ†ØµØ­ Ø¨Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø¢Ù†', 'warning');
        }

        // ØªØ´ØºÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
        window.addEventListener('load', () => {
            log('ğŸš€ Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª API Debug...', 'info');
            setTimeout(testDirectAPI, 1000);
        });
    </script>
</body>
</html>
